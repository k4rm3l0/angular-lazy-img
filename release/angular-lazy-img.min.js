angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers","$timeout",function(n,t,e,o,i){"use strict";function r(){i(function(){for(var n=y.length-1;n>=0;n--){var t=y[n];t&&o.isElementInView(t.$elem[0],C,f,t.orientation)&&(l(t),y.splice(n,1))}0===y.length&&c()},d.loadingDelay)}function a(n){v.forEach(function(t){t[n]("scroll",p),t[n]("touchmove",p)}),h[n]("resize",p),h[n]("resize",z)}function s(){I=!0,setTimeout(function(){r(),a("on")},1)}function c(){I=!1,a("off")}function u(n){var t=y.indexOf(n);-1!==t&&y.splice(t,1)}function l(n){var e=new Image;e.onerror=function(){d.errorClass&&n.$elem.addClass(d.errorClass),t.$emit("lazyImg:error",n),d.onError(n)},e.onload=function(){g(n.$elem,n.src),d.successClass&&n.$elem.addClass(d.successClass),t.$emit("lazyImg:success",n),d.onSuccess(n)},e.src=n.src}function g(n,t){"img"===n[0].nodeName.toLowerCase()?n[0].src=t:n.css("background-image",'url("'+t+'")')}function m(n,t){this.$elem=n,this.orientation=t}var f,h,y,I,d,p,z,v,$,C;return y=[],I=!1,d=e.getOptions(),h=angular.element(n),f=o.getWinDimensions(),z=o.throttle(function(){f=o.getWinDimensions()},60),v=[d.container||h],$=d.orientation||"v",C=d.offset||0,p=o.throttle(r,30),m.prototype.setSource=function(n){this.src=n,y.unshift(this),I||s()},m.prototype.removeImage=function(){u(this),0===y.length&&c()},m.prototype.checkImages=function(){r()},m.addContainer=function(n){c(),v.push(n),s()},m.removeContainer=function(n){c(),v.splice(v.indexOf(n),1),s()},m.setOrientation=function(n){$=n},m}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){},loadingDelay:1},this.$get=function(){var n=this.options;return{getOptions:function(){return n}}},this.setOptions=function(n){angular.extend(this.options,n)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(n){"use strict";function t(){return{height:n.innerHeight,width:n.innerWidth}}function e(n,t,e,o){var i=n.getBoundingClientRect(),r=e.height+t,a=e.width+t;return"h"===o?i.left>=0&&i.left<=a||i.right<=a&&i.right>=0-t:i.top>=0&&i.top<=r||i.bottom<=r&&i.bottom>=0-t}function o(n,t,e){var o,i;return function(){var r=e||this,a=+new Date,s=arguments;o&&o+t>a?(clearTimeout(i),i=setTimeout(function(){o=a,n.apply(r,s)},t)):(o=a,n.apply(r,s))}}return{isElementInView:e,getWinDimensions:t,throttle:o}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic",function(n,t){"use strict";function e(e,r,a){var s=new t(r,a.orientation),c=a.$observe("lazyImg",function(n){n&&(c(),s.setSource(n))});a.$observe("lazyImgZoom",function(n){var t=parseFloat(n)||100;a.lazyImgXhq&&t>i?s.setSource(a.lazyImgXhq):a.lazyImgHq&&t>o?s.setSource(a.lazyImgHq):s.setSource(a.lazyImg),s.checkImages()}),e.$on("$destroy",function(){s.removeImage()}),n.$on("lazyImg.runCheck",function(){s.checkImages()}),n.$on("lazyImg:refresh",function(){s.checkImages()})}var o=120,i=160;return{link:e,restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(n){"use strict";function t(t,e,o){n.addContainer(e),t.$on("$destroy",function(){n.removeContainer(e)})}return{link:t,restrict:"A"}}]);