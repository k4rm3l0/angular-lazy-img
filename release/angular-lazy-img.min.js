angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers","$timeout",function(n,e,t,o,i){"use strict";function r(){i(function(){for(var n=I.length-1;n>=0;n--){var e=I[n];e&&o.isElementInView(e.$elem[0],d.offset,f)&&(l(e),I.splice(n,1))}0===I.length&&c()},d.loadingDelay)}function a(n){v.forEach(function(e){e[n]("scroll",z),e[n]("touchmove",z)}),y[n]("resize",z),y[n]("resize",p)}function s(){h=!0,setTimeout(function(){r(),a("on")},1)}function c(){h=!1,a("off")}function u(n){var e=I.indexOf(n);-1!==e&&I.splice(e,1)}function l(n){var t=new Image;t.onerror=function(){d.errorClass&&n.$elem.addClass(d.errorClass),e.$emit("lazyImg:error",n),d.onError(n)},t.onload=function(){g(n.$elem,n.src),d.successClass&&n.$elem.addClass(d.successClass),e.$emit("lazyImg:success",n),d.onSuccess(n)},t.src=n.src}function g(n,e){"img"===n[0].nodeName.toLowerCase()?n[0].src=e:n.css("background-image",'url("'+e+'")')}function m(n){this.$elem=n}var f,y,I,h,d,z,p,v;return I=[],h=!1,d=t.getOptions(),y=angular.element(n),f=o.getWinDimensions(),p=o.throttle(function(){f=o.getWinDimensions()},60),v=[d.container||y],z=o.throttle(r,30),m.prototype.setSource=function(n){this.src=n,I.unshift(this),h||s()},m.prototype.removeImage=function(){u(this),0===I.length&&c()},m.prototype.checkImages=function(){r()},m.addContainer=function(n){c(),v.push(n),s()},m.removeContainer=function(n){c(),v.splice(v.indexOf(n),1),s()},m}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){},loadingDelay:1},this.$get=function(){var n=this.options;return{getOptions:function(){return n}}},this.setOptions=function(n){angular.extend(this.options,n)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(n){"use strict";function e(){return{height:n.innerHeight,width:n.innerWidth}}function t(n,e,t){var o=n.getBoundingClientRect(),i=t.height+e;return o.top>=0&&o.top<=i||o.bottom<=i&&o.bottom>=0-e}function o(n,e,t){var o,i;return function(){var r=t||this,a=+new Date,s=arguments;o&&o+e>a?(clearTimeout(i),i=setTimeout(function(){o=a,n.apply(r,s)},e)):(o=a,n.apply(r,s))}}return{isElementInView:t,getWinDimensions:e,throttle:o}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic","$timeout",function(n,e,t){"use strict";function o(o,r,a){var s=new e(r),c=a.$observe("lazyImg",function(n){n&&(c(),s.setSource(n))}),u=a.$observe("lazyImgZoom",function(n){var e=parseFloat(n);a.lazyImg&&a.lazyImg.length>0&&e&&e>i&&(u(),console.log("lazyImgZoom",a.lazyImgHq),a.lazyImgHq&&s.setSource(a.lazyImgHq))});o.$on("$destroy",function(){s.removeImage()}),n.$on("lazyImg.runCheck",function(){s.checkImages()}),n.$on("lazyImg:refresh",function(){s.checkImages(),console.log("CIAONE")}),n.$on("lazyImg:edit",function(n,e){s.removeImage(),s.setSource(e),t(function(){s.checkImages()})})}var i=120;return{link:o,restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(n){"use strict";function e(e,t){n.addContainer(t),e.$on("$destroy",function(){n.removeContainer(t)})}return{link:e,restrict:"A"}}]);